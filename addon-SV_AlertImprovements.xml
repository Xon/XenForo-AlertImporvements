<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="SV_AlertImprovements" title="Alert Improvements" version_string="1.3.2" version_id="1030200" url="https://xenforo.com/community/resources/alert-improvements-by-xon.4578/" install_callback_class="SV_AlertImprovements_Installer" install_callback_method="install" uninstall_callback_class="SV_AlertImprovements_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_AlertHandler_DiscussionMessage_Post" description="XenForo_AlertHandler_DiscussionMessage_Post"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="Dark_PostRating_AlertHandler" description="Dark_PostRating_AlertHandler"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_DataWriter_Alert" description="XenForo_DataWriter_Alert"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_Model_Alert" description="XenForo_Model_Alert"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Account" description="XenForo_ControllerPublic_Account"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Thread" description="XenForo_ControllerPublic_Thread"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Conversation" description="XenForo_ControllerPublic_Conversation"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Report" description="XenForo_ControllerPublic_Report"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Member" description="XenForo_ControllerPublic_Member"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_DataWriter_User" description="XenForo_DataWriter_User"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups/>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="sv_alert_page_skip_mark_read" version_id="1030000" version_string="1.3.0"><![CDATA[On viewing alerts page, do not mark alerts as read]]></phrase>
    <phrase title="sv_mark_all_alerts_read" version_id="1030000" version_string="1.3.0"><![CDATA[Mark all as read]]></phrase>
    <phrase title="sv_mark_unread" version_id="1000000" version_string="1.0.0"><![CDATA[Mark unread]]></phrase>
    <phrase title="your_post_in_the_thread_y_has_been_liked_x" version_id="1030000" version_string="1.3.0"><![CDATA[Your post in the thread {title} has been liked {likes} times.]]></phrase>
    <phrase title="your_post_in_the_thread_y_has_been_rated_x" version_id="1030000" version_string="1.3.0"><![CDATA[Your post in the thread {title} has been rated {ratings}]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="account_alerts_extra_controls" version_id="1030000" version_string="1.3.0"><![CDATA[<style>
.alertControls
{
  float:right;
  text-align:right;
}
</style>
<div class="alertControls">
<ul>
<li><a href="{xen:link account/alerts, '','skip_mark_read=0' }">{xen:phrase sv_mark_all_alerts_read}</a></li>
</ul>
</div>]]></template>
    <template title="account_alerts_sv_script" version_id="1030000" version_string="1.3.0"><![CDATA[<script>
!function($, window, document, _undefined)
{
   XenForo.markAlertUnread = function($link)
   {
        $link.click(function(e){
            XenForo.ajax
            (
                $link.attr('href'),
                '',
                function(ajaxData, textStatus)
                {
                    if (XenForo.hasResponseError(ajaxData))
                    {
                        return false;
                    }

                    $link.hide();
                    if ($link.parent().find('.newIcon').length == 0)
                    {
                        if (XenForo.hasTemplateHtml(ajaxData))
                        {
                            $link.parent().append(ajaxData.templateHtml);
                        }
                        else
                        {
                            $link.parent().append($('<span class="newIcon"></span>'));
                        }
                    }
                }
            );
            return false;
        });
   }
   XenForo.register('.markAlertUnread', 'XenForo.markAlertUnread');
}
(jQuery, this, document);
</script>]]></template>
    <template title="alert_postrating_rate_summary" version_id="1030000" version_string="1.3.0"><![CDATA[<xen:set var="$ratingString">
<xen:foreach loop="$extra.ratings" value="$data">
	<xen:set var="$ratingIcon"><xen:if is="{$data.rating.name}"><xen:if is="{$data.rating.sprite_mode}"><img src="styles/default/xenforo/clear.png" alt="" style="background: url('styles/dark/ratings/{$data.rating.name}') no-repeat {$data.rating.sprite_params.x}px {$data.rating.sprite_params.y}px; width: {$data.rating.sprite_params.w}px; height: {$data.rating.sprite_params.h}px; vertical-align: middle;" /><xen:else /><img src="styles/dark/ratings/{$data.rating.name}" alt="" style="vertical-align:middle" /></xen:if></xen:if></xen:set>
	{xen:raw $ratingIcon} {$data.count}
</xen:foreach>
</xen:set>

{xen:phrase your_post_in_the_thread_y_has_been_rated_x,
	'ratings={xen:raw $ratingString}',
	'title=<a href="{xen:link posts, $content}" class="PopupItemLink">{xen:helper threadPrefix, $content}{$content.title}</a>'}
	
	
	]]></template>
    <template title="alert_post_like_summary" version_id="1030000" version_string="1.3.0"><![CDATA[{xen:phrase your_post_in_the_thread_y_has_been_liked_x,
	'likes={$extra.likes}',
	'title=<a href="{xen:link posts, $content}" class="PopupItemLink">{xen:helper threadPrefix, $content}{$content.title}</a>'}]]></template>
    <template title="SV_AlertImprovements_Alert_Preferences" version_id="1030000" version_string="1.3.0"><![CDATA[<li>
    <label for="ctrl_sv_alerts_page_skips_mark_read"><input type="checkbox" name="sv_alerts_page_skips_mark_read" value="1" id="ctrl_sv_alerts_page_skips_mark_read" {xen:checked "{$visitor.sv_alerts_page_skips_mark_read}"} />
        {xen:phrase sv_alert_page_skip_mark_read}
    </label>
</li>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="account_alerts" modification_key="account_alerts_sv_controls" description="Extra controls for alerts" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:if is="{$alerts}">]]></find>
      <replace><![CDATA[$0
<xen:include template="account_alerts_extra_controls" />]]></replace>
    </modification>
    <modification template="account_alerts" modification_key="sv_alertimprovements_account_alerts" description="Mark as unread link" execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<div class="timeRow.*?)(</div>)#si]]></find>
      <replace><![CDATA[$1
<xen:if is="{$alert.view_date} or {$markedAlertsRead}">
<a class="markAlertUnread" href="{xen:link 'account/unread-alert', '', 'alert_id={$alert.alert_id}'}"><span class="unreadLink">{xen:phrase sv_mark_unread}</span></a>
</xen:if>
$2]]></replace>
    </modification>
    <modification template="account_alerts" modification_key="sv_alertimprovements_account_alerts2" description="javascript to ajaxify mark alert as unread" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:title>]]></find>
      <replace><![CDATA[<xen:include template="account_alerts_sv_script"/>
$0]]></replace>
    </modification>
    <modification template="account_preferences" modification_key="sv_alertimprovements_account_preferences" description="Alert Preferences" execution_order="4468" enabled="1" action="preg_replace">
      <find><![CDATA[#<xen:hook name="account_preferences_options".*?<ul>#si]]></find>
      <replace><![CDATA[$0
<xen:include template="SV_AlertImprovements_Alert_Preferences"/>]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
