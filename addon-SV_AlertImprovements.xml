<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="SV_AlertImprovements" title="Alert Improvements" version_string="1.4.1" version_id="1040100" url="https://xenforo.com/community/resources/alert-improvements-by-xon.4578/" install_callback_class="SV_AlertImprovements_Installer" install_callback_method="install" uninstall_callback_class="SV_AlertImprovements_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_AlertHandler_DiscussionMessage_Post" description="XenForo_AlertHandler_DiscussionMessage_Post"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_AlertHandler_User" description="XenForo_AlertHandler_User"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="Dark_PostRating_AlertHandler" description="Dark_PostRating_AlertHandler"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_DataWriter_Alert" description="XenForo_DataWriter_Alert"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_Model_Alert" description="XenForo_Model_Alert"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Account" description="XenForo_ControllerPublic_Account"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Thread" description="XenForo_ControllerPublic_Thread"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Conversation" description="XenForo_ControllerPublic_Conversation"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Report" description="XenForo_ControllerPublic_Report"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Member" description="XenForo_ControllerPublic_Member"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_DataWriter_User" description="XenForo_DataWriter_User"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups/>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="sv_alert_page_skip_mark_read" version_id="1030000" version_string="1.3.0"><![CDATA[On viewing alerts page, do not mark alerts as read]]></phrase>
    <phrase title="sv_mark_all_alerts_read" version_id="1030000" version_string="1.3.0"><![CDATA[Mark all as read]]></phrase>
    <phrase title="sv_mark_unread" version_id="1000000" version_string="1.0.0"><![CDATA[Mark unread]]></phrase>
    <phrase title="sv_summarized_alerts" version_id="1040000" version_string="1.4.0"><![CDATA[Summarized Alerts]]></phrase>
    <phrase title="sv_x_liked_y_content_z_times" version_id="1040000" version_string="1.4.0"><![CDATA[{name} <a {link}>liked {likedcontent}</a>]]></phrase>
    <phrase title="sv_x_rated_y_content_z_times" version_id="1040000" version_string="1.4.0"><![CDATA[On <a {link}>{count} of your posts</a>, {name} rated them {ratings}]]></phrase>
    <phrase title="sv_x_rated_y_content_z_times_with_l_likes" version_id="1040000" version_string="1.4.0"><![CDATA[On <a {link}>{count} of your posts</a>, {name} rated them {ratings}, and liked {likedcontent}]]></phrase>
    <phrase title="x_of_conversation_messages" version_id="1040000" version_string="1.4.0"><![CDATA[{count} of your conversation messages.]]></phrase>
    <phrase title="x_of_posts" version_id="1040000" version_string="1.4.0"><![CDATA[{count} of your posts.]]></phrase>
    <phrase title="x_of_report_comments" version_id="1040000" version_string="1.4.0"><![CDATA[{count} of your report comments.]]></phrase>
    <phrase title="your_post_in_the_thread_y_has_been_liked_x" version_id="1040000" version_string="1.4.0"><![CDATA[Your post in the thread {title} <a {link}>has been liked</a> {likes} times]]></phrase>
    <phrase title="your_post_in_the_thread_y_has_been_rated_x" version_id="1040000" version_string="1.4.0"><![CDATA[Your post in the thread {title} <a {link}>has been rated</a> {ratings}]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="account_alerts_extra_controls" version_id="1030000" version_string="1.3.0"><![CDATA[<style>
.alertControls
{
  float:right;
  text-align:right;
}
</style>
<div class="alertControls">
<ul>
<li><a href="{xen:link account/alerts, '','skip_mark_read=0' }">{xen:phrase sv_mark_all_alerts_read}</a></li>
</ul>
</div>]]></template>
    <template title="account_alerts_summary" version_id="1040000" version_string="1.4.0"><![CDATA[<xen:title>{xen:phrase sv_summarized_alerts}</xen:title>

<xen:edithint template="xenforo_alert.css" />

<xen:navigation>
	<xen:breadcrumb href="{xen:link account/alerts}">{xen:phrase alerts}</xen:breadcrumb>
</xen:navigation>

<div class="section">
	<ol class="alerts alertsScroller">
		<li class="alertGroup">
			<h2 class="textHeading"></h2>
			<ol>
				<li id="alert{$summaryAlert.alert_id}" class="primaryContent {xen:if $summaryAlert.new, 'new'}{xen:if '{$summaryAlert.unviewed}', ' unviewed'}" data-author="{$summaryAlert.user.username}">
					<xen:avatar user="$summaryAlert.user" size="s" img="true" class="plainImage" />
					<div class="alertText">
						<h3>{xen:raw $summaryAlert.template}</h3>
						<div class="timeRow"><span class="time muted">{xen:time $summaryAlert.event_date}</span><xen:if is="{$summaryAlert.new}"><span class="newIcon"></span></xen:if></div>
					</div>
				</li>
			</ol>
		</li>
	</ol>
	<xen:if is="{$alerts}">
		<ol class="alerts alertsScroller">
		<xen:foreach loop="$alerts" key="$date" value="$alertsDay">
			<li class="alertGroup">
				<h2 class="textHeading">{$date}</h2>
				<ol>
				<xen:foreach loop="$alertsDay" value="$alert">
					<li id="alert{$alert.alert_id}" class="primaryContent {xen:if $alert.new, 'new'}{xen:if '{$alert.unviewed}', ' unviewed'}" data-author="{$alert.user.username}">
						<xen:avatar user="$alert.user" size="s" img="true" class="plainImage" />
						<div class="alertText">
							<h3>{xen:raw $alert.template}</h3>
							<div class="timeRow"><span class="time muted">{xen:time $alert.event_date}</span><xen:if is="{$alert.new}"><span class="newIcon"></span></xen:if></div>
						</div>
					</li>
				</xen:foreach>
				</ol>
			</li>
		</xen:foreach>
		</ol>
		
		<xen:if is="{$totalAlerts} > {$perPage}">
		<xen:pagenav link="account/alert" linkdata="{$summaryAlert}" linkparams="{$pageNavParams}" page="{$page}" perpage="{$perPage}" total="{$totalAlerts}" />
		</xen:if>
			
	<xen:else />
	
		<p>{xen:phrase you_do_not_have_any_recent_alerts}</p>
		
	</xen:if>
	
</div>]]></template>
    <template title="account_alerts_sv_script" version_id="1030000" version_string="1.3.0"><![CDATA[<script>
!function($, window, document, _undefined)
{
   XenForo.markAlertUnread = function($link)
   {
        $link.click(function(e){
            XenForo.ajax
            (
                $link.attr('href'),
                '',
                function(ajaxData, textStatus)
                {
                    if (XenForo.hasResponseError(ajaxData))
                    {
                        return false;
                    }

                    $link.hide();
                    if ($link.parent().find('.newIcon').length == 0)
                    {
                        if (XenForo.hasTemplateHtml(ajaxData))
                        {
                            $link.parent().append(ajaxData.templateHtml);
                        }
                        else
                        {
                            $link.parent().append($('<span class="newIcon"></span>'));
                        }
                    }
                }
            );
            return false;
        });
   }
   XenForo.register('.markAlertUnread', 'XenForo.markAlertUnread');
}
(jQuery, this, document);
</script>]]></template>
    <template title="alert_post_like_summary" version_id="1040000" version_string="1.4.0"><![CDATA[{xen:phrase your_post_in_the_thread_y_has_been_liked_x,
	'likes={$extra.likes}',
	'link=href="{xen:link account/alert, '', 'alert_id={$alert_id}'}" class="OverlayTrigger"',
	'title=<a href="{xen:link posts, $content}" class="PopupItemLink">{xen:helper threadPrefix, $content}{$content.title}</a>'}
]]></template>
    <template title="alert_post_rate_summary" version_id="1040000" version_string="1.4.0"><![CDATA[<xen:set var="$ratingString">
<xen:foreach loop="$extra.ratings" key="$key" value="$rating">
	<xen:set var="$ratingIcon"><xen:if is="{$rating.name}"><xen:if is="{$rating.sprite_mode}"><img src="styles/default/xenforo/clear.png" alt="{$rating.title}" title="{$rating.title}" style="background: url('styles/dark/ratings/{$rating.name}') no-repeat {$rating.sprite_params.x}px {$rating.sprite_params.y}px; width: {$rating.sprite_params.w}px; height: {$rating.sprite_params.h}px; vertical-align: middle;" /><xen:else /><img src="styles/dark/ratings/{$rating.name}" alt="{$rating.title}" title="{$rating.title}"  style="vertical-align:middle" /></xen:if></xen:if></xen:set>
	{xen:raw $ratingIcon} x <strong>{xen:number $rating.count}</strong>
</xen:foreach>
</xen:set>

{xen:phrase your_post_in_the_thread_y_has_been_rated_x,
	'ratings={xen:raw $ratingString}',
	'link=href="{xen:link account/alert, '', 'alert_id={$alert_id}'}" class="OverlayTrigger"',
	'title=<a href="{xen:link posts, $content}" class="PopupItemLink">{xen:helper threadPrefix, $content}{$content.title}</a>'}
]]></template>
    <template title="alert_user_like_summary" version_id="1040100" version_string="1.4.1"><![CDATA[<xen:set var="$likeString">
<xen:foreach loop="$extra.likes" key="$contentType" value="$count">
	{$extra.likesPhrase.{$contentType}}
</xen:foreach>
</xen:set>

{xen:phrase sv_x_liked_y_content_z_times,
	'name={xen:helper username, $user, 'subject'}',
	'link=href="{xen:link account/alert, '', 'alert_id={$alert_id}'}" class="PopupItemLink OverlayTrigger"',
	'likedcontent={xen:raw $likeString}'}]]></template>
    <template title="alert_user_rate_summary" version_id="1040000" version_string="1.4.0"><![CDATA[<xen:set var="$ratingString">
<xen:foreach loop="$extra.ratings" key="$key" value="$rating">
	<xen:set var="$ratingIcon"><xen:if is="{$rating.name}"><xen:if is="{$rating.sprite_mode}"><img src="styles/default/xenforo/clear.png" alt="{$rating.title}" title="{$rating.title}" style="background: url('styles/dark/ratings/{$rating.name}') no-repeat {$rating.sprite_params.x}px {$rating.sprite_params.y}px; width: {$rating.sprite_params.w}px; height: {$rating.sprite_params.h}px; vertical-align: middle;" /><xen:else /><img src="styles/dark/ratings/{$rating.name}" alt="{$rating.title}" title="{$rating.title}"  style="vertical-align:middle" /></xen:if></xen:if></xen:set>
	{xen:raw $ratingIcon} x <strong>{xen:number $rating.count}</strong>
</xen:foreach>
</xen:set>

	
<xen:if is="{$extra.likesPhrase}">
<xen:set var="$likeString">
<xen:foreach loop="$extra.likes" key="$contentType" value="$count">
	{$extra.likesPhrase.{$contentType}}
</xen:foreach>
</xen:set>

{xen:phrase sv_x_rated_y_content_z_times_with_l_likes,
	'count={$extra.totalRatings}',
	'name={xen:helper username, $user, 'subject'}',
	'link=href="{xen:link account/alert, '', 'alert_id={$alert_id}'}" class="PopupItemLink OverlayTrigger"',
	'ratings={xen:raw $ratingString}',
	'likedcontent={xen:raw $likeString}'}
<xen:else />

{xen:phrase sv_x_rated_y_content_z_times,
	'count={$extra.totalRatings}',
	'name={xen:helper username, $user, 'subject'}',
	'link=href="{xen:link account/alert, '', 'alert_id={$alert_id}'}" class="PopupItemLink OverlayTrigger"',
	'ratings={xen:raw $ratingString}'}
</xen:if>]]></template>
    <template title="SV_AlertImprovements_Alert_Preferences" version_id="1030000" version_string="1.3.0"><![CDATA[<li>
    <label for="ctrl_sv_alerts_page_skips_mark_read"><input type="checkbox" name="sv_alerts_page_skips_mark_read" value="1" id="ctrl_sv_alerts_page_skips_mark_read" {xen:checked "{$visitor.sv_alerts_page_skips_mark_read}"} />
        {xen:phrase sv_alert_page_skip_mark_read}
    </label>
</li>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="account_alerts" modification_key="account_alerts_sv_controls" description="Extra controls for alerts" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:if is="{$alerts}">]]></find>
      <replace><![CDATA[$0
<xen:include template="account_alerts_extra_controls" />]]></replace>
    </modification>
    <modification template="account_alerts" modification_key="sv_alertimprovements_account_alerts" description="Mark as unread link" execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<div class="timeRow.*?)(</div>)#si]]></find>
      <replace><![CDATA[$1
<xen:if is="{$alert.view_date} or {$markedAlertsRead}">
<a class="markAlertUnread" href="{xen:link 'account/unread-alert', '', 'alert_id={$alert.alert_id}'}"><span class="unreadLink">{xen:phrase sv_mark_unread}</span></a>
</xen:if>
<xen:if is="{$alert.isSummary}">
<a class="unsummarizeAlert" href="{xen:link 'account/unsummarize-alert', '', 'alert_id={$alert.alert_id}'}"><span class="unreadLink">{xen:phrase sv_unsummarize_alert}</span></a>
</xen:if>
$2]]></replace>
    </modification>
    <modification template="account_alerts" modification_key="sv_alertimprovements_account_alerts2" description="javascript to ajaxify mark alert as unread" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:title>]]></find>
      <replace><![CDATA[<xen:include template="account_alerts_sv_script"/>
$0]]></replace>
    </modification>
    <modification template="account_preferences" modification_key="sv_alertimprovements_account_preferences" description="Alert Preferences" execution_order="4468" enabled="1" action="preg_replace">
      <find><![CDATA[#<xen:hook name="account_preferences_options".*?<ul>#si]]></find>
      <replace><![CDATA[$0
<xen:include template="SV_AlertImprovements_Alert_Preferences"/>]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
