<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="SV_AlertImprovements" title="Alert Improvements" version_string="1.3.0" version_id="1030000" url="https://xenforo.com/community/resources/alert-improvements-by-xon.4578/" install_callback_class="SV_AlertImprovements_Installer" install_callback_method="install" uninstall_callback_class="SV_AlertImprovements_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_Model_Alert" description="XenForo_Model_Alert"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Account" description="XenForo_ControllerPublic_Account"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Thread" description="XenForo_ControllerPublic_Thread"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Conversation" description="XenForo_ControllerPublic_Conversation"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Report" description="XenForo_ControllerPublic_Report"/>
    <listener event_id="load_class" execute_order="4578" callback_class="SV_AlertImprovements_Listener" callback_method="load_class" active="1" hint="XenForo_DataWriter_User" description="XenForo_DataWriter_User"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups/>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="sv_alert_page_skip_mark_read" version_id="1030000" version_string="1.3.0"><![CDATA[On viewing alerts page, do not mark alerts as read]]></phrase>
    <phrase title="sv_mark_unread" version_id="1000000" version_string="1.0.0"><![CDATA[Mark unread]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="SV_AlertImprovements_Alert_Preferences" version_id="1030000" version_string="1.3.0"><![CDATA[<li>
    <label for="ctrl_sv_alerts_page_skips_mark_read"><input type="checkbox" name="sv_alerts_page_skips_mark_read" value="1" id="ctrl_sv_alerts_page_skips_mark_read" {xen:checked "{$visitor.sv_alerts_page_skips_mark_read}"} />
        {xen:phrase sv_alert_page_skip_mark_read}
    </label>
</li>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="account_alerts" modification_key="sv_alertimprovements_account_alerts" description="Mark as unread link" execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<div class="timeRow.*?)(</div>)#si]]></find>
      <replace><![CDATA[$1
<xen:if is="{$alert.view_date} or {$markedAlertsRead}">
<a class="markAlertUnread" href="{xen:link 'account/unread-alert', '', 'alert_id={$alert.alert_id}'}"><span class="unreadLink">{xen:phrase sv_mark_unread}</span></a>
</xen:if>
$2]]></replace>
    </modification>
    <modification template="account_alerts" modification_key="sv_alertimprovements_account_alerts2" description="javascript to ajaxify mark alert as unread" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:title>]]></find>
      <replace><![CDATA[<script>
!function($, window, document, _undefined)
{
   XenForo.markAlertUnread = function($link)
   {
        $link.click(function(e){
            XenForo.ajax
            (
                $link.attr('href'),
                '',
                function(ajaxData, textStatus)
                {
                    if (XenForo.hasResponseError(ajaxData))
                    {
                        return false;
                    }

                    $link.hide();
                    if ($link.parent().find('.newIcon').length == 0)
                    {
                        if (XenForo.hasTemplateHtml(ajaxData))
                        {
                            $link.parent().append(ajaxData.templateHtml);
                        }
                        else
                        {
                            $link.parent().append($('<span class="newIcon"></span>'));
                        }
                    }
                }
            );
            return false;
        });
   }
   XenForo.register('.markAlertUnread', 'XenForo.markAlertUnread');
}
(jQuery, this, document);
</script>
$0]]></replace>
    </modification>
    <modification template="account_preferences" modification_key="sv_alertimprovements_account_preferences" description="Alert Preferences" execution_order="4468" enabled="1" action="preg_replace">
      <find><![CDATA[#<xen:hook name="account_preferences_options".*?<ul>#si]]></find>
      <replace><![CDATA[$0
<xen:include template="SV_AlertImprovements_Alert_Preferences"/>]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
